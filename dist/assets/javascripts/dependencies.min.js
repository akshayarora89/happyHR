"use strict";angular.module("happyHrApp",["ngRoute","ngResource","ngFileUpload"]).service("API",[function(){this.url=function(){return"http://happyhrapi.n1.iworklab.com/public/api/"}}]).constant("IntegrationConstants",{templatePath:"assets/templates/"}).config(["$routeProvider","IntegrationConstants","$injector",function(e,t,a){e.when("/find-jobs",{templateUrl:t.templatePath+"find-jobs.html",controller:"FindJobsCtrl",title:"Find Jobs"}),e.when("/find-jobs/:advId",{templateUrl:t.templatePath+"job-details.html",controller:"JobDetailsCtrl",title:"Job Details"}),e.when("/partners",{templateUrl:t.templatePath+"partners.html",controller:"PartnersCtrl",title:"Partners"}),e.when("/faq",{templateUrl:t.templatePath+"faq.html",controller:"FaqCtrl",title:"Faq"}),e.otherwise({redirectTo:"/find-jobs"})}]),angular.module("happyHrApp").controller("AppCtrl",["$scope","Upload","$timeout","API","JobService",function(e,t,a,n,o){e.jobDetails={},e.pageHeading="",e.pageDetails="";$("#applyJobModal").on("shown.bs.modal",function(t){e.jobDetails.advertisementID=$(t.relatedTarget).data("advid")}),$("#applyJobModal").on("hidden.bs.modal",function(){$(this).find("form")[0].reset()}),e.applyJob=function(){e.jobDetails.eligibleToWorkInAustralia=e.jobDetails.eligibleToWorkInAustralia?1:0,e.resumeFile&&r(e.resumeFile,function(t,a){a?e.resumeErrorMsg=a:(e.resumeFile=t,e.jobDetails.resume=e.resumeFile.result&&e.resumeFile.result.data?e.resumeFile.result.data.candidateData:"",e.coverFile?r(e.coverFile,function(t,a){a?e.coverErrorMsg=a:(e.coverFile=t,e.jobDetails.coverLetter=e.coverFile.result&&e.coverFile.result.data?e.coverFile.result.data.candidateData:"",l(e.jobDetails,function(){$("#applyJobModal").modal("toggle")}))}):(e.jobDetails.coverLetter="",l(e.jobDetails,function(){$("#applyJobModal").modal("toggle")})))})};var r=function(e,o){e&&(e.upload=t.upload({url:n.url()+"file-upload",data:{candidateData:e}}),e.upload.then(function(t){a(function(){console.log("success response>>>",t),e.result=t.data,o(e,null)})},function(t){if(console.log("Error response>>>",t),t.status>0)var a=t.status+": "+t.data;o(e,a)}))},l=function(e,t){console.log("data to be saved>>>",e);var a=o.applyJob(),n=new a;for(var r in e)n[r]=e[r];a.save(n,function(e){console.log("data saved>>>",e),t()})}}]),angular.module("happyHrApp").controller("FaqCtrl",["$scope","JobService",function(e,t){e.showSearchResults=!1,e.$parent.pageHeading="",e.$parent.pageDetails="",t.getFaqCategories().get(function(t){e.categories=t.data&&t.data.length?t.data:[],o(e.categories,function(t){e.allFaqDetails=t,e.categories&&e.categories.length&&a(e.categories[0]),e.$apply()})}),e.selectCategory=function(e){e&&a(e)},e.searchFaqs=function(){if(e.searchInput&&""!=e.searchInput){e.showSearchResults=!0;var t=[];for(var a in e.allFaqDetails){var n={},o=e.allFaqDetails[a];n.faqCategoryID=o.faqCategoryID,n.title=o.title,n.question=[];var r=o.question?o.question:[];r&&r.length&&r.filter(function(t){-1!=t.question.toLowerCase().indexOf(e.searchInput.toLowerCase())&&n.question.push(t)}),n.question&&n.question.length&&t.push(n)}e.searchedFaqs=t}else e.showSearchResults=!1,e.searchedFaqs=[]};var a=function(t){e.allFaqDetails&&e.allFaqDetails[t.faqCategoryID]?e.faqDetails=e.allFaqDetails[t.faqCategoryID]:console.log("No Faq details present for category with category Id: ",faqCategoryID)},n=function(e){return new Promise(function(a,n){e&&e.faqCategoryID?t.getFaqDetails().get({id:e.faqCategoryID},function(e){e&&e.data?a(e.data,null):n()},function(e){a(null,e)}):n()})},o=function(e,t){var a={};e&&e.length&&e.filter(function(o,r){n(o).then(function(n,o){o?console.log("Error in fetching FAQ Data: ",o):(a[n.faqCategoryID]=n,r==e.length-1&&t(a))})})}}]),angular.module("happyHrApp").controller("FindJobsCtrl",["$scope","IntegrationConstants","JobService",function(e,t,a){e.showJobFunctionDropdown=!1,e.$parent.pageHeading="Find a job that makes you happy",e.$parent.pageDetails="Search or browse jobs across Australia and apply!";var n={},o={"full-time":{from:{name:"Paying Annual",range:["0","40000","60000","80000","100000","120000","140000","160000","180000"]},to:{name:"to",range:["40000","60000","80000","100000","120000","140000","160000","180000","200000+"]}},"part-time":{from:{name:"Per Hour",range:["0","10","15","20","25","30","35","40","45"]},to:{name:"to",range:["10","15","20","25","30","35","40","45","50+"]}},default:{from:{name:"paying",range:[]},to:{name:"to",range:[]}}};e.selectedPayscale={from:"",to:""},e.currentPayscale=o.default,e.pager={};var r=function(){a.getSearchJobResults().query({options:JSON.stringify(n)},function(t){e.searchedJobs=t,e.dummyJobs=e.searchedJobs.slice(),e.setPage(1)})};r(),e.defaultLocation={locationID:null,title:"Location"},e.defaultIndustry={industryID:null,title:"Industry"},e.defaultJobFunction={jobFunctionID:null,title:"Job Function"},e.defaultEmploymentType={employmentTypeID:null,title:"Employment Type"},e.selectedLocation=e.defaultLocation,e.selectedIndustry=e.defaultIndustry,e.selectedJobFunction=e.defaultJobFunction,e.selectedEmploymentType=e.defaultEmploymentType,e.selectLoc=function(t){e.selectedLocation=t,t.locationID?n.locationID=t.locationID:delete n.locationID},e.selectIndustry=function(t){e.selectedIndustry=t,e.showJobFunctionDropdown=!0,t.industryID?(n.industryID=t.industryID,a.getJobFunctions().get({id:t.industryID},function(t){e.jobFunctions=t.data,e.selectedJobFunction={jobFunctionID:"default",title:"Job Function"}},function(t){e.jobFunctions=[],e.selectedJobFunction={jobFunctionID:"default",title:"Job Function"}})):(delete n.industryID,e.showJobFunctionDropdown=!1)},e.selectJobFunction=function(t){e.selectedJobFunction=t,t.jobFunctionID?n.jobFunctionID=t.jobFunctionID:delete n.jobFunctionID},e.selectEmploymentType=function(t){e.selectedPayscale={from:"",to:""},e.selectedEmploymentType=t,t.employmentTypeID?n.employmentTypeID=t.employmentTypeID:delete n.employmentTypeID,r(),l(t)},a.getFilterData().get(function(t){e.filterData=t?t.data:{}}),e.searchJobs=function(){r()};var l=function(t){if(t&&t.title)switch(t.title){case"Full time":e.currentPayscale=o["full-time"];break;case"Part time":e.currentPayscale=o["part-time"];break;default:e.currentPayscale=o.default}};e.payscaleChanged=function(t){console.log("payscale change event>>>>",t,e.selectedPayscale)},e.setPage=function(t){(t<1||t>e.pager.totalPages)&&!e.dummyJobs.length||(e.pager=a.getPager(e.dummyJobs.length,t),e.searchedJobs=e.dummyJobs.slice(e.pager.startIndex,e.pager.endIndex+1))}}]),angular.module("happyHrApp").controller("JobDetailsCtrl",["$scope","IntegrationConstants","$routeParams","JobService",function(e,t,a,n){var o={advertisementID:a.advId};n.getSearchJobResults().query({options:JSON.stringify(o)},function(t){e.jobDetails=t&&t.length?t[0]:{}})}]),angular.module("happyHrApp").controller("PartnersCtrl",["$scope","JobService",function(e,t){e.$parent.pageHeading="Referral partners",e.$parent.pageDetails="Our happy partners provide their clients with a HR solution they can count on.",t.getPartnersList().get(function(t){t.data&&(e.stateList=t.data.stateList,e.partners=t.data.partnerData)}),e.setPartnerData=function(t){e.selectedPartner=t}}]),angular.module("happyHrApp").service("JobService",["$resource","API",function(e,t){this.getFilterData=function(){return e(t.url()+"marketing/get-job-filter-data")},this.getJobFunctions=function(){return e(t.url()+"marketing/get-job-functions-by-industry/:id")},this.getSearchJobResults=function(){return e(t.url()+"marketing/search-jobs/:options")},this.applyJob=function(){return e(t.url()+"marketing/apply-jobs")},this.getPartnersList=function(){return e(t.url()+"marketing/get-partner-list")},this.getFaqCategories=function(){return e(t.url()+"marketing/get-faq-category")},this.getFaqDetails=function(){return e(t.url()+"marketing/get-faqDetail/:id")},this.getPager=function(e,t,a){t=t||1,a=a||5;var n,o,r=Math.ceil(e/a);r<=10?(n=1,o=r):t<=6?(n=1,o=10):t+4>=r?(n=r-9,o=r):(n=t-5,o=t+4);var l=(t-1)*a;return{totalItems:e,currentPage:t,pageSize:a,totalPages:r,startPage:n,endPage:o,startIndex:l,endIndex:Math.min(l+a-1,e-1),pages:_.range(n,o+1)}}}]);